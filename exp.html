<!-- exp.html for crea-v experiment -->
<!doctype html>
<html>

    <head>
        <title>CREA-V demo</title>
        <script src="/static/lib/jquery-min.js" type="text/javascript"></script>
        <script src="/static/lib/underscore-min.js" type="text/javascript"></script>
        <script src="/static/lib/backbone-min.js" type="text/javascript"></script>

        <script src="/static/js/jspsych/jspsych.js" type="text/javascript"></script>
        <script src="/static/js/jspsych/plugins/jspsych-text.js" type="text/javascript"></script>
        <script src="/static/js/jspsych/plugins/jspsych-single-stim.js" type="text/javascript"></script>

        <script src="/static/js/psiturk.js" type="text/javascript"></script>

<!--    below are added -->
        <script src="/static/js/jspsych/plugins/jspsych-instructions.js" type="text/javascript"></script>
        <script src="/static/js/jspsych/plugins/jspsych-html-keyboard-response.js" type="text/javascript"></script>
        <script src="/static/js/jspsych/plugins/jspsych-survey-likert.js" type="text/javascript"></script>
        <script src="/static/js/stims.js" type="text/javascript"></script>
<!--         added-->

        <script type="text/javascript">
            // These fields provided by the psiTurk Server
            var uniqueId = "{{ uniqueId }}"; // a unique string identifying the worker/task
            var adServerLoc = "{{ adServerLoc }}"; // the location of your ad (so you can send user back at end of experiment)
            var mode = "{{ mode }}"; // is this running live, sandbox, or in debug mode?
			      var condition = {{ condition }}; // the condition number
			      var counterbalance = {{ counterbalance }}; // a number indexing counterbalancing conditions

        </script>

        <link href="/static/css/jspsych.css" rel="stylesheet" type="text/css"></link>
        <!-- <link href="/static/css/style.css" rel="stylesheet" type="text/css"></link> -->

        <style>
          h {text-align: center; font-size:200%;}
          p {text-align: left; font-size:150%;}
        </style>
    </head>

    <body>ã„´
<!--         <div id='jspsych-target' class='center-content'></div>
 --></body>

    <!-- experiment logic script -->
    <!-- <script src="/static/js/task.js" type="text/javascript"> -->

    <script>
    /* load psiturk */
    var psiturk = new PsiTurk(uniqueId, adServerLoc, mode);

    var timeline = [];

    // var welcome_block = {
    //     type: "text",
    //     text: "Welcome to the experiment. Press the SPACE key to begin.",
    //     cont_key: [' ']
    // };

    // var welcome_block = {
    //     type: "instructions",
    //     pages: ['<p> Welcome to the experiment. Click next to begin.</p>'],
    //     show_clickable_nav: true,
    // };


    var welcome_block = {
    type: 'instructions',
    pages: ['<p> Welcome to the experiment. Click next to begin.</p>',
      "<p>In this experiment, you will rate a verb against a range of properties. </p>",
      '<p>Click to start the experiment.</p>'],
    show_clickable_nav: true,
    show_page_number: true,
    on_finish: function(){
        psiturk.finishInstructions()}
    };
    timeline.push(welcome_block);

    var scale=["N/A", "0", "1", "2", "3", "4", "5", "6"];

    stims = jsPsych.randomization.shuffle(stims);

    var crea_question_trial = {
      type: 'survey-likert',
      questions: function() {
        var prompts = [
        {
            prompt: jsPsych.timelineVariable("question", true),
            name: jsPsych.timelineVariable("verb", true),
            labels: scale, 
            required: true
        },
        ];
        return prompts;
      },
      // data: {condition: jsPsych.timelineVariable('condition'), correct_response:jsPsych.timelineVariable('correct_response')},
      randomize_question_order: true,
      };

    var trial_info_static = [
      {"question": "<h><b> chair </b></h><br><h>As in: <i>The boy sat in a chair</i></h> <p><b>To what degree do you think of this thing as being associated with pain or physical discomfort?</b></p> <p> For comparison, 'headache' would receive a high rating on this question, because headaches are associated with a lot of pain and physical discomfort. <br><br> In contrast, 'pin' might receive a medium rating, because a pin might accidentally cause pain.</p><br><p>Your rating for <b>chair</b>:</p>", 
      "verb": 'chair',
      "attribute": 'pain'},
       {"question": "<h><b> flower </b></h><br><h>As in: <i>The girl put a flower in vase</i></h> <p><b>To what degree do you think of this thing as being associated with a color?</b></p> <p> For comparison, 'tomato' would receive a high rating on this question, because tomatos are typically red. <br><br> In contrast, 'pin' might receive a medium rating, because a pin might accidentally cause pain.</p><br><p>Your rating for <b>flower</b>:</p>", 
        "verb": 'flower',
        "attribute": 'color'},
       {"question": "<h><b> Snoopy </b></h><br><h>As in: <i>My Snoopy was lying on the roof</i></h> <p><b>To what degree do you think of this thing as being associated with adorableness?</b></p> <p> For comparison, 'puppy' would receive a high rating on this question, because puppys are associated with adorableness. <br><br> In contrast, 'mouse' might receive a medium rating, because a mouse may or may not be adorable</p><br><p>Your rating for <b>Snoopy</b>:</p>",
        "verb": 'Snoopy',
        "attribute": 'adorableness'},
       {"question": "<h><b> sofa </b></h><br><h>As in: <i>He was sitting on his sofa all day </i></h> <p><b>To what degree do you think of this thing as being associated with pleasure?</b></p> <p> For comparison, 'cotton candy' would receive a high rating on this question, because cotton candies are associated with a lot of fun and tastiness. <br><br> In contrast, 'shopping' might receive a medium rating, because shopping may accidentally cause pleasure.</p><br><p>Your rating for <b>sofa</b>:</p>",
        "verb": 'sofa',
        "attribute": 'pleasure'
         }
    ];

    var crea_survey_procedure = {
                timeline: [crea_question_trial],
                timeline_variables: stims
            }
    timeline.push(crea_survey_procedure);





    // var instructions_block = {
    //     type: "text",
    //     text: "<p>In this experiment, a word will appear in the center " +
    //         "of the screen.</p><p>When the word appears respond with the <strong>color</strong> " +
    //         "in which the word is printed as quickly as you can.</p><p> press <strong>R</strong> " +
    //         "for red, <strong>G</strong> for green, and <strong>B</strong> for blue.</p>" +
    //         "<p>Press the SPACE key to begin.</p>",
    //     timing_post_trial: 1000,
    //     cont_key: [' '],
    //     on_finish: function(){
    //         psiturk.finishInstructions();
    //     }
    // };

    // var instructions = {
    //     type: "instructions",
    //     pages: ['Welcome!', '<p>Press the f key when you see a nonword.</p><p>Press the j key when you see a word.</p><p> Click the next button.'],
    //     show_clickable_nav: true,
    //     on_finish: function(){
    //         psiturk.finishInstructions();
    //     }
    //     // on_finish: function(){
    //     //     psiturk.finishInstructions();
    //     // }
    // };

    // timeline.push(instructions);


        /* stimuli specifications */
    // var trials = [
    //     {
    //         stimulus: "<p style='font-size: 50px; color: red;'>SHIP</p>",
    //         data: {word: 'SHIP', color: 'red', stimulus_type: 'unrelated', correct_response: 'R'}
    //     },
    //     {
    //         stimulus: "<p style='font-size: 50px; color: green;'>MONKEY</p>",
    //         data: {word: 'MONKEY', color: 'green', stimulus_type: 'unrelated', correct_response: 'G'}
    //     },
    //     {
    //         stimulus: "<p style='font-size: 50px; color: blue;'>ZAMBONI</p>",
    //         data: {word: 'ZAMBONI', color: 'blue', stimulus_type: 'unrelated', correct_response: 'B'}
    //     },
    //     {
    //         stimulus: "<p style='font-size: 50px; color: red;'>RED</p>",
    //         data: {word: 'RED', color: 'red', stimulus_type: 'congruent', correct_response: 'R'}
    //     },
    //     {
    //         stimulus: "<p style='font-size: 50px; color: green;'>GREEN</p>",
    //         data: {word: 'GREEN', color: 'green', stimulus_type: 'congruent', correct_response: 'G'}
    //     },
    //     {
    //         stimulus: "<p style='font-size: 50px; color: blue;'>BLUE</p>",
    //         data: {word: 'BLUE', color: 'blue', stimulus_type: 'congruent', correct_response: 'B'}
    //     },
    //     {
    //         stimulus: "<p style='font-size: 50px; color: red;'>GREEN</p>",
    //         data: {word: 'GREEN', color: 'red', stimulus_type: 'incongruent', correct_response: 'R'}
    //     },
    //     {
    //         stimulus: "<p style='font-size: 50px; color: green;'>BLUE</p>",
    //         data: {word: 'BLUE', color: 'green', stimulus_type: 'incongruent', correct_response: 'G'}
    //     },
    //     {
    //         stimulus: "<p style='font-size: 50px; color: blue;'>RED</p>",
    //         data: {word: 'RED', color: 'blue', stimulus_type: 'incongruent', correct_response: 'B'}
    //     }
    // ];

    // var fixation = {
    //         type: "html-keyboard-response",
    //         stimulus: '<span style="font-size:40px;">+</span>',
    //         choices: jsPsych.NO_KEYS, 
    //         trial_duration: 1000,
    //         data: {stimulus_type: 'fixation'}
    //     };

    // var word_trial = {
    //     type: 'html-keyboard-response',
    //     stimulus: '<span style="font-size:40px;">apple</span>',
    //     choices: ['f', 'j'],
    //     prompt: 'f = nonword, j = word',
    //     stimulus_duration: 2000,
    //     data: {condition: 'word', correct_response: 'j'}
    // };

    // var nonword_trial = {
    //     type: 'html-keyboard-response',
    //     stimulus: '<span style="font-size:40px;">moxid</span>',
    //     choices: ['f', 'j'],
    //     prompt: 'f = nonword, j = word',
    //     stimulus_duration: 2000,
    //     data: {condition: 'nonword', correct_response: 'f'}
    // };




//     var fixation = {
//     type: 'single-stim',
//     stimulus: '<p style="font-size: 50px;">+</p>',
//     choices: jsPsych.NO_KEYS,
//     timing_response: 500,
//     is_html: true,
//     data: {stimulus_type: 'fixation'}
// };

// var word = {
//     type: 'single-stim',
//     stimulus:  jsPsych.timelineVariable('stimulus'),
//     choices: ['r','g', 'b'],
//     is_html: true,
//     data: jsPsych.timelineVariable('data'),
//     on_finish: function(d){
//         d.correct = d.key_press == d.correct_response.charCodeAt(0);
//     }
// };


// var lexical_decision_trial = {
//             type: 'html-keyboard-response',
//             stimulus: jsPsych.timelineVariable('stimulus'),
//             choices: ['f', 'j'],
//             stimulus_duration: 2000,
//             data: {condition: jsPsych.timelineVariable('condition'), correct_response:jsPsych.timelineVariable('correct_response')},
//             post_trial_gap: 1000,
//             on_finish: function(data) {
//                 var accuracy = 0;
//                 if (data.correct_response == jsPsych.pluginAPI.convertKeyCodeToKeyCharacter(data.key_press)) {
//                     accuracy = 1;
//                 }
//                 data.accuracy = accuracy;
//             }
//         };


// var trial_info = [
//             {stimulus: '<span style="font-size:40px;">apple</span>', condition: 'word', correct_response: 'j'},
//             {stimulus: '<span style="font-size:40px;">snowman</span>', condition: 'word', correct_response: 'j'},
//             {stimulus: '<span style="font-size:40px;">moxid</span>', condition: 'nonword', correct_response: 'f'},
//             {stimulus: '<span style="font-size:40px;">applof</span>', condition: 'nonword', correct_response: 'f'}
//         ];


// var lexical_decision_procedure = {
//             timeline: [fixation, lexical_decision_trial],
//             timeline_variables: trial_info
//         }
// timeline.push(lexical_decision_procedure);



// var test_procedure = {
//     timeline: [fixation, word_trial, nonword_trial],
//     // timeline_variables: trials,
//     // randomize_order: true
// };
// timeline.push(test_procedure);

// var summary = {
//     type: 'single-stim',
//     stimulus: function(){
//         var congruent_rt = jsPsych.data.get().filter({stimulus_type: 'congruent'}).select('rt').mean();
//         var incongruent_rt = jsPsych.data.get().filter({stimulus_type: 'incongruent'}).select('rt').mean();
//         var unrelated_rt = jsPsych.data.get().filter({stimulus_type: 'unrelated'}).select('rt').mean();
//         var congruent_pct = 100 * jsPsych.data.get().filter({stimulus_type: 'congruent'}).select('correct').mean();
//         var incongruent_pct = 100 * jsPsych.data.get().filter({stimulus_type: 'incongruent'}).select('correct').mean();
//         var unrelated_pct = 100 * jsPsych.data.get().filter({stimulus_type: 'unrelated'}).select('correct').mean();
//         return '<p>Your average response time on congruent trials was '+Math.round(congruent_rt)+'ms. '+
//             'Your average response time on incongruent trials was '+Math.round(incongruent_rt)+'ms. '+
//             'Your average response time on unrelated trials was '+Math.round(unrelated_rt)+'ms.</p>'+
//             '<p>Your average percent correct on congruent trials was '+Math.round(congruent_pct)+'%. '+
//             'Your average percent correct on incongruent trials was '+Math.round(incongruent_pct)+'%. '+
//             'Your average percent correct on unrelated trials was '+Math.round(unrelated_pct)+'%.</p>'+
//             '<p>Thanks for participating! Press "q" to finish the experiment.</p>';
//     },
//     choices: ['q'],
//     is_html: true
// };
// timeline.push(summary);

    /* record id, condition, counterbalance on every trial */
    // jsPsych.data.addProperties({
    //     uniqueId: uniqueId,
    //     condition: condition,
    //     counterbalance: counterbalance
    // });
 
var bye_block = {
    type: 'instructions',
    pages: ['You reached the end of the experiment. Thank you for your participation! Click to exit.'],
    show_clickable_nav: true,
    show_page_number: false
  };

timeline.push(bye_block)


    jsPsych.init({
        // display_element: 'jspsych-target',
        timeline: timeline,
        // record data to psiTurk after each trial
        on_data_update: function(data) {
            psiturk.recordTrialData(data);
        },
        on_finish: function() {
            // record proportion correct as unstructured data
            jsPsych.data.displayData();
            // psiturk.recordUnstructuredData("bonus", jsPsych.data.get()
            //                                .filter([{stimulus_type: 'incongruent'},
            //                                         {stimulus_type: 'congruent'},
            //                                         {stimulus_type: 'unrelated'}])
            //                                .select('correct')
            //                                .mean()
            //                                .toFixed(2));
            // psiturk.recordUnstructuredData("bonus", jsPsych.data.get()
            //                                .filter([{stimulus_type: 'word_trial'},
            //                                         {stimulus_type: 'nonword_trial'}])
            //                                .select('accuracy')
            //                                .mean()
            //                                .toFixed(2));

            
            // save data
            psiturk.saveData({
                success: function() {
                    // upon saving, add proportion correct as a bonus (see custom.py) and complete HIT
                    psiturk.computeBonus("compute_bonus", function () {
                        psiturk.completeHIT();
                    });
                }
            });
        },
    });


    </script>

</html>
